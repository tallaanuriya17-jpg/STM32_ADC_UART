# STM32 Timer Triggered ADC with DMA and UART

## ğŸ“Œ Project Overview
This project implements a *timer-triggered ADC data acquisition system* using the *STM32F401 (Black Pill)* microcontroller.  
ADC conversions are initiated by a *hardware timer overflow, ensuring deterministic sampling. The conversion results are transferred to memory using **Direct Memory Access (DMA)* and then transmitted through *UART*.

The entire system was designed using *STM32CubeMX* and implemented in *STM32CubeIDE* following professional embedded-system development practices.

---

## ğŸ¯ Objectives
- Configure STM32 system clock to 84 MHz
- Generate a periodic timer interrupt at *100 Hz*
- Trigger ADC conversion using *timer TRGO*
- Transfer ADC results to memory using *DMA*
- Transmit ADC values via *UART*
- Verify system behavior using software build and simulation

---

## ğŸ›  Tools & Software Used
- STM32CubeIDE  
- STM32CubeMX  
- STM32 HAL Library  
- Proteus (software simulation)  

---

## âš™ï¸ System Configuration

### ğŸ”¹ Microcontroller Selection
*MCU:* STM32F401CC (Black Pill)

ğŸ“· STM32CubeMX â€“ MCU Selection  
![MCU Selection](images/mcu_selection.png)
<img width="1309" height="680" alt="mpu selector" src="https://github.com/user-attachments/assets/b4d6a63b-6cc9-475a-8ce1-607e7ae86857" />


---

### ğŸ”¹ Clock Configuration
- SYSCLK: *84 MHz*
- APB1: *42 MHz*
- APB2: *84 MHz*

ğŸ“· Clock Configuration  
![Clock Configuration](images/clock_configuration.png)
<img width="1254" height="604" alt="clock config" src="https://github.com/user-attachments/assets/3b529b56-3619-4d95-8ae1-154887e6bb66" />

---

### ğŸ”¹ Timer Configuration (TIM2 â€“ 100 Hz)
- Prescaler: 8399
- Auto Reload Register (ARR): 99
- Trigger Output (TRGO): *Update Event*

ğŸ“· TIM2 Configuration  
![TIM2 Configuration](images/tim2_configuration.png)
<img width="707" height="577" alt="timer" src="https://github.com/user-attachments/assets/2ebba717-5b8b-4004-bab9-846e03c8f7fc" />

---

### ğŸ”¹ ADC Configuration
- ADC Instance: *ADC1*
- Channel: *ADC1_IN0 (PA0)*
- Resolution: *12-bit*
- External Trigger: *TIM2 TRGO*
- Trigger Edge: *Rising Edge*

ğŸ“· ADC Configuration  
![ADC Trigger](images/adc_trigger.png)
<img width="709" height="598" alt="adc-p" src="https://github.com/user-attachments/assets/4630b172-9c9e-4b26-82c4-de6ad40b539c" />

---

### ğŸ”¹ DMA Configuration
- Mode: *Circular*
- Direction: *Peripheral â†’ Memory*
- Data Width: *Half Word*
- Memory Increment: *Enabled*

ğŸ“· DMA Configuration  
![DMA Configuration](images/dma_configuration.png)
<img width="953" height="600" alt="adc-dma" src="https://github.com/user-attachments/assets/0d95186c-2c61-4306-b0ad-78cbaaaab79e" />
---

### ğŸ”¹ UART Configuration
- USART2
- Baud Rate: *115200*
- 8-N-1, No flow control

ğŸ“· UART Configuration  
![UART Configuration](images/uart_configuration.png)
<img width="956" height="599" alt="uart-p" src="https://github.com/user-attachments/assets/5c57429b-c2f2-4a65-a3cd-563e5c1cc0aa" />
<img width="951" height="592" alt="uart-nvic" src="https://github.com/user-attachments/assets/a18ce2ec-c087-4df8-b3c1-325682f0e2da" />

---

## ğŸ” System Working Principle

ğŸ“· System Flow Diagram  
![System Flow](images/system_flow.png)

1. TIM2 generates an update event every *10 ms*
2. Update event is routed internally as *TRGO*
3. ADC conversion starts on each trigger
4. DMA transfers ADC data automatically to memory
5. UART transmits ADC values to serial terminal

---

## ğŸ’» Firmware Implementation

The firmware was developed using *STM32CubeIDE* with *HAL drivers*.  
DMA is used to minimize CPU involvement and ensure efficient real-time data transfer.

---

### ğŸ“„ main.c (Core Application Code)

```c
#include "main.h"

ADC_HandleTypeDef hadc1;
DMA_HandleTypeDef hdma_adc1;
TIM_HandleTypeDef htim2;
UART_HandleTypeDef huart2;

uint16_t adc_value;
char uart_buf[50];

int main(void)
{
  HAL_Init();
  SystemClock_Config();

  MX_GPIO_Init();
  MX_DMA_Init();
  MX_ADC1_Init();
  HAL_ADC_Start_DMA(&hadc1, (uint32_t*)&adc_value, 1);
  MX_TIM2_Init();
  MX_USART2_UART_Init();

  while (1)
  {
    /* CPU remains free */
  }
}

void HAL_ADC_ConvCpltCallback(ADC_HandleTypeDef* hadc)
{
    if (hadc->Instance == ADC1)
    {
        int len = sprintf(uart_buf, "ADC Value: %d\r\n", adc_value);
        HAL_UART_Transmit(&huart2, (uint8_t*)uart_buf, len, HAL_MAX_DELAY);
    }
}


## ğŸ§ª Build Output (Software Verification)

After implementing the firmware, the project was compiled using **STM32CubeIDE**.

### âœ” Build Status
- Build completed successfully
- **0 Errors**
- Minor warnings due to unused autogenerated functions
- HAL libraries linked correctly

ğŸ“· *Build Output Screenshot (0 Errors)*  
![Build Output](images/build_success.png)
<img width="1086" height="689" alt="buid " src="https://github.com/user-attachments/assets/c0db836f-9347-4efe-b608-7fed753256c0" />


This confirms that:
- Peripheral initialization code is correct
- Timer, ADC, DMA, and UART configurations are valid
- The firmware is ready for execution on hardware or simulation

---

## ğŸ“Š Results

### âœ” Functional Results
- TIM2 successfully configured to generate update events at **100 Hz**
- ADC conversion triggered using **TIM2 TRGO**
- ADC results transferred to memory using **DMA in circular mode**
- UART configured to transmit ADC values at **115200 baud**
- ADC values updated periodically without CPU polling

### âœ” Sample UART Output
ğŸ“· *UART Output (Simulation)*  
![UART Output](images/uart_output.png)

---

## ğŸ§ª Simulation Verification

Since hardware execution could not be demonstrated, the system behavior was verified using **software simulation**.

Verification steps:
- STM32F401 microcontroller model loaded with compiled firmware
- ADC input simulated using a virtual potentiometer/signal source
- UART output observed on a virtual terminal
- ADC values varied correctly with changes in input signal

ğŸ“· *Proteus Simulation Schematic*  
![Proteus Schematic](images/proteus_schematic.png)

ğŸ“· *Proteus UART Output*  
![Proteus UART](images/proteus_uart.png)

---

## âœ… Advantages

- Hardware timer ensures **deterministic sampling**
- DMA minimizes CPU load and avoids polling
- Suitable for real-time data acquisition systems
- Scalable for multiple ADC channels
- Uses industry-standard STM32 HAL drivers

---

## âš ï¸ Limitations

- Physical hardware execution not demonstrated due to lack of external programmer/debugger
- ADC values in simulation are software-generated
- UART output on real hardware requires external USB-to-TTL interface

---

## ğŸ“Œ Conclusion

A **timer-triggered ADC data acquisition system using DMA and UART** was successfully designed and verified at the software level.  
The project builds without errors, and functional correctness was validated through configuration analysis and simulation.

The firmware design is complete and **ready for deployment on real STM32 hardware** using an external programmer.

---

## ğŸš€ Future Enhancements

- Hardware testing using ST-LINK
- Multi-channel ADC acquisition
- Digital filtering and averaging
- RTOS-based task scheduling
